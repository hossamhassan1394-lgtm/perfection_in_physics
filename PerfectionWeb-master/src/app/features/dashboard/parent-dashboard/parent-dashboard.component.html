<div class="dashboard-container">
  <!-- Top Navigation -->
  <nav class="top-nav">
    <div class="nav-content">
      <!-- Logo & Brand -->
      <div class="brand">
        <div class="logo-circle">
          <lucide-angular [img]="Atom" class="logo-icon"></lucide-angular>
        </div>
        <div class="brand-text">
          <h1 class="brand-name">Perfection in Physics</h1>
          <p class="brand-subtitle">Excellence Portal</p>
        </div>
      </div>

      <!-- User Info & Actions -->
      <div class="nav-actions">
        <div class="user-info">
          <div class="status-dot"></div>
          <div class="user-details">
            <p class="user-name">{{ selectedStudent()?.name || 'Ahmed Hassan' }}</p>
            <p class="user-grade">{{ selectedStudent()?.grade || '3rd Secondary (Grade 12)' }}</p>
          </div>
        </div>

        <button class="settings-btn" title="Settings" (click)="openSettings()">
          <lucide-angular [img]="Settings" class="btn-icon"></lucide-angular>
        </button>

        <button class="lang-btn" title="Toggle language" (click)="toggleLanguage()">
          {{ lang() === 'en' ? 'Ø¹/AR' : 'EN' }}
        </button>

        <button *ngIf="isLoggedIn()" class="logout-btn" (click)="onLogout()">
          <span>{{ lang() === 'en' ? 'Logout' : 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬' }}</span>
          <lucide-angular [img]="LogOut" class="btn-icon"></lucide-angular>
        </button>
      </div>
    </div>
  </nav>

  <!-- Settings Modal -->
  <div *ngIf="showSettings()" class="settings-modal-overlay">
    <div class="settings-modal">
      <h3>{{ lang() === 'en' ? 'Change Password' : 'ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±' }}</h3>
      <div class="form-row">
        <label>{{ lang() === 'en' ? 'Current Password' : 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©' }}</label>
        <input type="password" [ngModel]="currentPassword()" (ngModelChange)="onCurrentPasswordChange($event)"
          name="currentPassword" />
      </div>
      <div class="form-row">
        <label>{{ lang() === 'en' ? 'New Password' : 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©' }}</label>
        <input type="password" [ngModel]="newPassword()" (ngModelChange)="onNewPasswordChange($event)"
          name="newPassword" />
      </div>
      <div class="form-row">
        <label>{{ lang() === 'en' ? 'Confirm Password' : 'ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±' }}</label>
        <input type="password" [ngModel]="confirmPassword()" (ngModelChange)="onConfirmPasswordChange($event)"
          name="confirmPassword" />
      </div>
      <div class="settings-message" *ngIf="settingsMessage()">{{ settingsMessage() }}</div>
      <div class="modal-actions">
        <button class="btn btn-primary" (click)="submitChangePassword()">{{ lang() === 'en' ? 'Save' : 'Ø­ÙØ¸' }}</button>
        <button class="btn btn-secondary" (click)="closeSettings()">{{ lang() === 'en' ? 'Cancel' : 'Ø¥Ù„ØºØ§Ø¡' }}</button>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <main class="main-content">
    <div class="content-wrapper">

      <!-- Student Selector -->
      <div class="student-selector-wrapper">
        <label for="student-select" class="selector-label">
          <lucide-angular [img]="Users" class="label-icon"></lucide-angular>
          {{ lang() === 'en' ? 'SELECT STUDENT' : 'Ø§Ø®ØªØ± Ø§Ù„Ø·Ø§Ù„Ø¨' }}
        </label>
        <div class="select-container">
          <select id="student-select" class="student-select" [ngModel]="selectedStudentId()"
            (ngModelChange)="onStudentChange($event)" [disabled]="students().length <= 1">
            <option *ngFor="let student of students()" [value]="student.id">
              {{ student.name }}
            </option>
          </select>
          <lucide-angular [img]="ChevronDown" class="select-arrow"></lucide-angular>
        </div>
      </div>

      <div *ngIf="selectedStudent()">

        <!-- Hero Profile Card -->
        <div class="hero-card">
          <div class="hero-content">
            <!-- Left Section -->
            <div class="hero-left">
              <p class="hero-welcome">Welcome</p>
              <h2 class="hero-name">{{ selectedStudent()!.name }}</h2>
              <div class="hero-meta">
                <span class="student-id-badge">{{ selectedStudent()!.id }}</span>
                <span class="student-grade">{{ selectedStudent()!.grade }}</span>
              </div>
              <div class="hero-stats-pills">
                <span class="stat-pill">
                  <lucide-angular [img]="Calendar" class="pill-icon"></lucide-angular>
                  {{ sessionCount() }} {{ sessionCount() === 1 ? 'Session' : 'Sessions' }}
                </span>
              </div>
              <div class="location-pill">
                <lucide-angular [img]="MapPin" class="location-icon"></lucide-angular>
                Alexandria, Egypt
              </div>
            </div>

            <!-- Right Section - Illustration -->
            <div class="hero-right">
              <div class="illustration-container">
                <div class="illustration-blob"></div>
                <div class="illustration-items">
                  <div class="illust-item item-1">
                    <lucide-angular [img]="Atom" class="illust-icon"></lucide-angular>
                  </div>
                  <div class="illust-item item-2">
                    <lucide-angular [img]="Zap" class="illust-icon"></lucide-angular>
                  </div>
                  <div class="illust-item item-3">
                    <lucide-angular [img]="BookOpen" class="illust-icon"></lucide-angular>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Shamel Grade Panel -->
        <div *ngIf="hasShamelData()" class="shamel-panel">
          <div class="shamel-section shamel-current">
            <div class="section-header">
              <lucide-angular [img]="Trophy" class="header-icon"></lucide-angular>
              <span class="header-label">{{ lang() === 'en' ? 'CURRENT SHAMEL GRADE / GENERAL EXAM' : 'Ø¯Ø±Ø¬Ø© Ø§Ù„Ø´Ø§Ù…Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠØ© / Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø§Ù„Ø¹Ø§Ù…' }}</span>
              <span class="date-badge">December 2025</span>
            </div>
            <div class="shamel-grade-display">
              <div class="grade-numbers">
                <span class="grade-score">{{ getCurrentShamel().score }}</span>
                <span class="grade-separator">/</span>
                <span class="grade-total">{{ getCurrentShamel().total }}</span>
              </div>
              <p class="grade-subtitle">{{ getCurrentShamel().label || 'Comprehensive Assessment' }}</p>
            </div>
            <div class="circular-progress">
              <svg viewBox="0 0 140 140" class="progress-svg">
                <circle cx="70" cy="70" r="60" class="progress-bg"></circle>
                <circle cx="70" cy="70" r="60" class="progress-fill"
                  [style.stroke-dashoffset]="(getCurrentShamel().total ? (377 - (377 * (getCurrentShamel().score / getCurrentShamel().total))) : 377)">
                </circle>
              </svg>
              <div class="progress-text">{{ getCurrentShamel().total ? (Math.round((getCurrentShamel().score / getCurrentShamel().total) * 100) + '%') : '0%' }}</div>
            </div>
          </div>
        </div>

      </div>

      <!-- Statistics Cards Row -->
      <div class="stats-row">
        <!-- Attendance Card -->
        <div class="stat-card attendance-card">
          <div class="stat-icon-wrapper attendance-icon">
            <lucide-angular [img]="Calendar" class="stat-icon"></lucide-angular>
          </div>
          <div class="stat-content">
            <p class="stat-label">{{ lang() === 'en' ? 'ATTENDANCE RATE' : 'Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø­Ø¶ÙˆØ±' }}</p>
            <p class="stat-value">{{ getAttendancePercentage() }}%</p>
            <p class="stat-detail">{{ attendedCount() }}/{{ sessionCount() }} sessions</p>
          </div>
          <div class="stat-visual">
            <svg viewBox="0 0 100 100" class="ring-svg">
              <circle cx="50" cy="50" r="40" class="ring-bg"></circle>
              <circle cx="50" cy="50" r="40" class="ring-fill attendance-ring"
                [style.stroke-dashoffset]="251 - (251 * getAttendancePercentage() / 100)"></circle>
            </svg>
          </div>
          <div class="stat-progress-bar">
            <div class="progress-fill attendance-fill" [style.width.%]="getAttendancePercentage()"></div>
          </div>
        </div>

        <!-- Payment Card -->
        <div class="stat-card payment-card">
          <div class="stat-icon-wrapper payment-icon">
            <lucide-angular [img]="DollarSign" class="stat-icon"></lucide-angular>
          </div>
          <div class="stat-content">
            <p class="stat-label">{{ lang() === 'en' ? 'TOTAL PAYMENT' : 'Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¯ÙØ¹' }}</p>
            <p class="stat-value payment-value">{{ getTotalPayment() }}</p>
            <p class="stat-detail">EGP</p>
          </div>
        </div>

        <!-- Quiz Performance Card -->
        <div class="stat-card quiz-card">
          <div class="stat-icon-wrapper quiz-icon">
            <lucide-angular [img]="GraduationCap" class="stat-icon"></lucide-angular>
          </div>
          <div class="stat-content">
            <p class="stat-label">{{ lang() === 'en' ? 'QUIZ PERFORMANCE' : 'Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±' }}</p>
            <p class="stat-value">{{ getQuizPerformance() }}%</p>
            <p class="stat-detail">{{ getQuizDetails().correct }}/{{ getQuizDetails().total }} correct</p>
          </div>
          <div class="stat-visual">
            <div class="bar-chart">
              <div class="bar" [style.height.%]="getQuizPerformance()"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Session History Section -->
      <div class="session-section">
        <div class="section-header-row">
          <div class="section-title-group">
            <lucide-angular [img]="BookOpen" class="title-icon"></lucide-angular>
            <div>
              <h3 class="section-title">Session History</h3>
              <p class="section-subtitle">Detailed record of all physics sessions</p>
            </div>
          </div>
        </div>

        <!-- Session Cards Carousel -->
        <div class="carousel-wrapper">
          <button class="carousel-nav nav-left" (click)="scrollSessions('left')">
            <lucide-angular [img]="ChevronLeft" class="nav-icon"></lucide-angular>
          </button>

          <div class="session-cards" #sessionCarousel>
            <div *ngFor="let session of sessions()" class="session-card" [class.general-exam-card]="session.is_general_exam">
              <!-- Session Header -->
              <div class="session-header">
                <div class="session-icon-wrapper" [class.general-exam-icon]="session.is_general_exam">
                  <lucide-angular [img]="session.is_general_exam ? Trophy : Zap" class="session-icon"></lucide-angular>
                </div>
                <div class="session-title-group">
                  <h4 class="session-title">
                    <span *ngIf="session.is_general_exam" class="exam-badge">ğŸ† GENERAL EXAM</span>
                    {{ session.lectureName || ('Session #' + session.id + ' â€¢ Chapter ' + session.chapter) }}
                  </h4>
                  <p class="session-topic">{{ session.name }}</p>
                </div>
                <span class="status-badge" [ngClass]="session.attendance">
                  <span class="badge-dot"></span>
                  {{ session.attendance === 'attended' ? 'Attended' : session.attendance === 'upcoming' ? 'Upcoming' :
                  'Missed' }}
                </span>
              </div>

              <!-- Session Info Grid -->
              <div class="session-info-grid">
                <div class="info-item">
                  <div class="info-icon-wrapper">
                    <lucide-angular [img]="Clock" class="info-icon"></lucide-angular>
                  </div>
                  <p class="info-label">{{ lang() === 'en' ? 'START TIME' : 'ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©' }}</p>
                  <div class="info-value">
                    <div *ngIf="formatTimestamp(session.start_time || session.startTime) as st"
                      style="background:#f59e0b;color:#000;padding:6px 10px;border-radius:6px;font-weight:700;display:inline-block;">
                      {{ st }}
                    </div>
                    <div *ngIf="!(session.start_time || session.startTime)">-</div>
                  </div>
                </div>

                <div class="info-item">
                  <div class="info-icon-wrapper">
                    <lucide-angular [img]="Clock" class="info-icon"></lucide-angular>
                  </div>
                  <p class="info-label">{{ lang() === 'en' ? 'END TIME' : 'ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡' }}</p>
                  <div class="info-value">
                    <div *ngIf="formatTimestamp(session.endTime) as et"
                      style="background:#f59e0b;color:#000;padding:6px 10px;border-radius:6px;font-weight:700;display:inline-block;">
                      {{ et }}
                    </div>
                    <div *ngIf="!session.endTime">-</div>
                  </div>
                </div>

                <div class="info-item">
                  <div class="info-icon-wrapper">
                    <lucide-angular [img]="GraduationCap" class="info-icon"></lucide-angular>
                  </div>
                  <p class="info-label">{{ lang() === 'en' ? 'QUIZ SCORE' : 'Ø¯Ø±Ø¬Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±' }}</p>
                  <p class="info-value">{{ session.quizCorrect }}/{{ session.adminQuizMark || session.quizTotal }}</p>
                  <p class="info-sub">{{ lang() === 'en' ? 'questions' : 'Ø£Ø³Ø¦Ù„Ø©' }}</p>
                </div>

                <div class="info-item">
                  <div class="info-icon-wrapper">
                    <lucide-angular [img]="DollarSign" class="info-icon"></lucide-angular>
                  </div>
                  <p class="info-label">{{ lang() === 'en' ? 'PAYMENT' : 'Ø§Ù„Ø¯ÙØ¹' }}</p>
                  <p class="info-value">{{ session.payment }} EGP</p>
                </div>

                <div class="info-item" *ngIf="session.mark !== undefined">
                  <div class="info-icon-wrapper">
                    <lucide-angular [img]="Trophy" class="info-icon"></lucide-angular>
                  </div>
                  <p class="info-label">{{ lang() === 'en' ? 'MARK' : 'Ø§Ù„Ø¹Ù„Ø§Ù…Ø©' }}</p>
                  <p class="info-value">{{ session.mark }}</p>
                </div>
              </div>

              <!-- Homework Status -->
              <div class="homework-status">
                <div class="homework-left">
                  <lucide-angular [img]="FileText" class="homework-icon"></lucide-angular>
                  <span class="homework-label">{{ lang() === 'en' ? 'Homework Status' : 'Ø­Ø§Ù„Ø© Ø§Ù„ÙˆØ§Ø¬Ø¨' }}</span>
                </div>
                <span class="homework-badge" [ngClass]="session.homeworkStatus">
                  {{ session.homeworkStatus === 'completed' ? 'Completed' : 'Pending' }}
                </span>
              </div>

              <!-- Session Date -->
              <div class="session-footer">
                <lucide-angular [img]="Calendar" class="footer-icon"></lucide-angular>
                <span class="session-date">{{ session.date }}</span>
              </div>
            </div>
          </div>

          <button class="carousel-nav nav-right" (click)="scrollSessions('right')">
            <lucide-angular [img]="ChevronRight" class="nav-icon"></lucide-angular>
          </button>
        </div>
      </div>
    </div>
  </main>
</div>